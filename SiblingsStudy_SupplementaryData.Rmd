---
title             : "Analysing the effect of sibling number on input and output in the first 18 months: Supplementals"
shorttitle        : "Effect of sibling number on language: Supplementals"

author:
  - name          : "Catherine Laing"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Department of Language and Linguistic Science, University of York, Heslington, York, UK, YO10 5DD"
    email         : "catherine.laing@york.ac.uk"
  - name          : "Elika Bergelson"
    affiliation   : "2"

affiliation:
  - id            : "1"
    institution   : "University of York, York, UK"
  - id            : "2"
    institution   : "Duke University, Durham, NC, USA"

keywords          : "Siblings, Lexical Development, Input Effects, Language Acquisition"
wordcount         : "X"

#bibliography      : ["supplementaries.bib"]

floatsintext      : yes
figsintext        : yes 
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no
replace_ampersands: no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library(papaja)
library(tidyverse)
library(dplyr)
library(tibble)
library(lmerTest)
library(afex)
#library(citr)
library(feather)
library(corrplot)
library(kableExtra)

source("DataGathering.R")

# remove one of the twins from each dataset

demographics <- demographics %>% filter(subj != 351)
sib.ages <- sib.ages %>% filter(subj != 351)
SiblingsData <- SiblingsData %>% filter(subj != 351 & !month %in% c("06", "07", "08", "09"))
CDI <- CDI %>% filter(subj != 351 & !month %in% c("06", "07", "08", "09"))
speaker.type <- speaker.type %>% filter(subj != 351 & !month %in% c("06", "07", "08", "09"))
object.presence <- object.presence %>% filter(subj != 351 & !month %in% c("06", "07", "08", "09"))

# eb2cl: hm wait a sec you have month as a numeric var so those filters aren't actually going to work; please check and correct as needed here and in main
```


```{r setup2, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!-- eb2cl: we need a bit of a preview of what the SI are going to contain, a little intro summary paragraph to the SI that delineates what the supplement contains (kinda like our infancy one) or even just a table of contents type of list would work! -->

## S1: Effect of siblings on infants' input - audio recordings

Our main results analyse input data from the hour-long video recordings taken in the home on a monthly basis. We re-ran our analysis using the home-recorded audio data, which captures a snapshot from a daylong recording using a LENA device (https://www.lena.org/) worn in a vest. In this case, age but not sex was included in both models.
<!-- eb2cl: i think the reader needs a little more background: how much data per child is this, why did we opt to only use video in the main, and why is age but not sex included? -->

```{r effects of age and sex on input, include=FALSE}

# Parental input

# age

age.test.input <- lmer(Log.n ~ month + (1|subj), data = subset(speaker.type, caregiver == "FAMILY" & audio_video == "audio"), REML=FALSE)
age.test.input.null <- lmer(Log.n ~ (1|subj), data = subset(speaker.type, caregiver == "FAMILY" & audio_video == "audio"), REML=FALSE)

age.test.input_anova <- anova(age.test.input, age.test.input.null) %>% # p<.001 
  rename("pval" = `Pr(>Chisq)`) # significant effect of age on input

# sex

sex.test.input <- lmer(Log.n ~ sex + (1|subj), data = subset(speaker.type, caregiver == "FAMILY" & audio_video == "audio"), REML=FALSE)
sex.test.input.null <- lmer(Log.n ~ (1|subj), data = subset(speaker.type, caregiver == "FAMILY" & audio_video == "audio"), REML=FALSE)

sex.test.input_anova <- anova(sex.test.input, sex.test.input.null) %>% # NS
  rename("pval" = `Pr(>Chisq)`)

# Object presence

# age

age.test.OP <- lmer(PC ~ month + (1|subj), data = subset(object.presence, audio_video == "audio"), REML=FALSE)
age.test.OP.null <- lmer(PC ~ (1|subj), data = subset(object.presence, audio_video == "audio"), REML=FALSE)

age.test.OP_anova <- anova(age.test.OP, age.test.OP.null) %>% # p<.001
  rename("pval" = `Pr(>Chisq)`)

# sex

sex.test.OP <- lmer(Log.n ~ sex + (1|subj), data = subset(object.presence, audio_video == "audio"), REML=FALSE)
sex.test.OP.null <- lmer(Log.n ~ (1|subj), data = subset(object.presence, audio_video == "audio"), REML=FALSE)

sex.test.OP_anova <- anova(sex.test.OP, sex.test.OP.null) %>% #NS
  rename("pval" = `Pr(>Chisq)`)

input.sex.age.pvals <- rbind(age.test.input_anova, sex.test.input_anova, age.test.OP_anova, sex.test.OP_anova) %>% rownames_to_column()

```

```{r speaker.type model audio, include=FALSE}

speaker.type.model.null <- lmerTest::lmer(Log.n ~ month + (1|subj), data=subset(speaker.type, audio_video == "audio" & 
                                                                                           caregiver == "FAMILY"), REML=FALSE)
speaker.type.model <- lmerTest::lmer(Log.n ~ SibGroup + month + (1|subj), data=subset(speaker.type, audio_video == "audio" & 
                                                                                           caregiver == "FAMILY"), REML=FALSE)

speaker.type_anova <- anova(speaker.type.model, speaker.type.model.null) %>% # NS
  rename("pval" = `Pr(>Chisq)`)

input.model.summary <- summary(speaker.type.model)

input.model.summary.table <- input.model.summary$coefficients %>%
  as.data.frame %>%
  rename("p value" = "Pr(>|t|)") %>%
  rownames_to_column(var="Effect") %>%
  mutate(Effect = ifelse(Effect == "(Intercept)", "Intercept", Effect)) %>%
  # printnum(
  #   digits = c(2, 2, 2, 2, 3, 3)) %>%
  mutate(`p value` = scales::pvalue(`p value`),
         Variable = ifelse(Effect == "Intercept", "Caregiver input", ""))

```

```{r object.presence model audio, include = FALSE}

object.presence.model <- lmerTest::lmer(PC ~ SibGroup + month + (1|subj), data=subset(object.presence,  audio_video == "audio"), REML=FALSE)
object.presence.model.null <- lmerTest::lmer(PC ~ month + (1|subj), data=subset(object.presence,  audio_video == "audio"), REML=FALSE)

object.presence.anova <- anova(object.presence.model, object.presence.model.null) %>% # p<.001
  rename("pval" = `Pr(>Chisq)`)

object.presence.model.summary <- summary(object.presence.model)

table.object.presence.model.summary <- object.presence.model.summary$coefficients %>%
  as.data.frame %>%
  rename("p value" = "Pr(>|t|)") %>%
  rownames_to_column(var="Effect") %>%
  mutate(Effect = ifelse(Effect == "(Intercept)", "Intercept", Effect)) %>%
  # printnum(
  #   digits = c(2, 2, 2, 2, 3, 3)) %>%
  mutate(`p value` = scales::pvalue(`p value`),
         Variable = ifelse(Effect == "Intercept", "Object presence", ""))

```

```{r model outputs - audio data, include = FALSE}

table.input.model.output <- rbind(speaker.type_anova, object.presence.anova
                                ) %>%
  rownames_to_column(var="model") %>%
  filter(Chisq > 0) %>%
  rename("p value" = "pval") %>%
  mutate(Model = ifelse(grepl("speaker", model), "Caregiver input", "Object presence")) %>%
  select(Model, Df, Chisq, `p value`)


input.variables.model.summaries.audio <- rbind(input.model.summary.table, table.object.presence.model.summary) %>%
  dplyr::select(Variable, Effect, Estimate, `Std. Error`, `df`, `t value`, `p value`)

```

Outputs from model comparisons and full model outputs including estimates are shown in Tables \@ref(tab:table-model-comparisons-audio) and \@ref(tab:table-input-model-summary-audio). Results were consistent with the video data for object presence, but not overall input.
<!-- eb2cl: needs a little more: what model comparison? what full model output? not consistent how? -->
<!-- for this first pair of tables (and the other versions that also show up below): 
i find the captions a little confusing. the first one isnt' full model output right, it's just model comparison?
The second one is two different model outputs, right?
Here and below can we put the actual model formulas (written out in the text with minimal opaque abbreviations) to help readers along?
-->

```{r table-model-comparisons-audio, echo=FALSE}
cap = "Full model output from linear mixed effects regression models comparing our two input measures in relation to sibling group in the audio data. Age in months was included as a fixed effect; subject was included as a random effect."
kable(table.input.model.output, "latex", booktabs=T, longtable=T, 
       escape=FALSE,
       caption=cap, digits=2, align="c") 
```

```{r table-input-model-summary-audio, echo=FALSE}
cap = "Full model output from linear mixed effects regression models comparing our two input measures (object words produced in caregiver input and object presence) over time in relation to sibling group, for the audio data. Age in months was included as a fixed effect in both models and subject was included as a random effect."
 kable(input.variables.model.summaries.audio, "latex", booktabs=T, longtable=T, 
       escape=FALSE,
       caption=cap, digits=2, align="c") %>%
   row_spec(4, hline_after = T)
```

\newpage

## S2: Speakers in the dataset

The table below provides a summary of which two caregivers produced the most words in each video recording analyized in the main manuscript. This was usually the mother and/or the father.
<!-- eb2cl: i'm confused about where the 344 in the caption comes from--oh i see your note, i'd remind readers that these recordings are from 10-17mo not the full range (which i think you also did for the audio analysis above, right?) 
Hm but then i'm still confused: what shoudl the columns be tallying up to? e.g looks like 515 and 214, but shouldn't it be 344*2?-->


```{r speaker type count, include = FALSE}

speakers.sessions <- speaker.type %>% filter(caregiver %in% c("CG1", "CG2") & audio_video == "video") %>% 
  group_by(speaker, caregiver, month) %>% tally() %>% summarise(total = sum(n)) %>%
  mutate(speaker = str_to_title(speaker)) %>%
  mutate(Speaker = ifelse(speaker == "Fat", "Father", speaker),
         Speaker = ifelse(speaker %in% c("Mot", "Mt2"), "Mother", Speaker),
         Speaker = ifelse(speaker == "Grm", "Grandmother", Speaker),
         Speaker = ifelse(speaker == "Grp", "Grandfather", Speaker),
         Speaker = ifelse(speaker == "Mot+Fat", "Both parents", Speaker),
         Speaker = as.factor(Speaker)) %>%
  pivot_wider(names_from = caregiver, values_from = total) %>%
  ungroup() %>%
  dplyr::select(-speaker) %>%
  group_by(Speaker) %>%
  summarise(`Caregiver 1` = sum(CG1,na.rm = T),
            `Caregiver 2` = sum(CG2,na.rm = T)) %>%
  arrange(desc(`Caregiver 1`))

# data with 2 mothers - both are counted in the mother row
# number of video sessions (from a total of )
#43*8 # 344 sessions recorded in total
```


```{r table-speakers-sessions, echo = FALSE}
cap = "Numer of sessions in which each adult speaker is one of the two main caregivers. There were 344 hour-long video recordings in total across the 43 infants in the dataset. In the case where the infant had two mothers, their data was aggregated into the 'Mother' category; in all but two sessions from this family, the two mothers were the two main caregivers."
 kable(speakers.sessions, "latex", booktabs=T, longtable=T, 
       escape=FALSE,
       caption=cap, align="c")
```

\newpage

## S3: Correlations with maternal factors

```{r age_mom-Sibling correlation, include = FALSE}

corr.data.input <- speaker.type %>% filter(audio_video == "video", month == 17, speaker == "MOT") %>% ungroup() %>%
  dplyr::select(subj, n)

corr.data.mat <- SiblingsData %>%
  filter(month == 18) %>% 
    left_join(corr.data.input, by = "subj") %>%
           dplyr::select(age_mom, MOTedulevel, Siblings18, Total.words, n) %>%
  rename(
    "Maternal age" = "age_mom",
    "Maternal education" = "MOTedulevel",
    "N Siblings" = "Siblings18",
    "CDI words" = "Total.words",
    "Input words" = "n")

corr.matrix <- cor(corr.data.mat, method = "spearman", use="complete.obs")

#mat.corr.matrix <- corrplot(corr.matrix, method = "number")

```

There were no correlations between sibling number or child word production and maternal age/education. See Figure \@ref(fig:Figure-correlations).
<!-- eb2cl: the fig # isn't rendering in the text & either is the caption -->
<!-- eb2cl: i'm also a little confused here: it looks like these are spearman correlations coeffecients but you have'nt told the reader that and i'm also not sure how you're inferring that none of the correlations are significant from what you've graphed? based on a quick skim of the help for corrplot, corrplot has various ways to visualize which corrs are significant by a certain threshold but i think you'd have to reformulate your data a bit -->

```{r Figure-correlations, echo=FALSE, fig.cap=cap, fig.pos='H', message=FALSE, warning=FALSE}
par(cex = 1.2)
corrplot(corr.matrix, method = "number")
cap <- sprintf("Correlation matrix showing correlation coefficient of Spearman's correlation tests between maternal factors (age and education), number of siblings, and number of words reported to be produced by the child at age 18 months. Colours represent strength of correlation, whereby bolder colours indicate a stronger correlation between variables.")

```
\newpage

## S4: Discrete sibling  number

```{r speaker.type model, include = FALSE}

#shapiro.test(speaker.type$n) # not normal

speaker.type.model.null.discrete <- lmerTest::lmer(Log.n ~ month + sex + (1|subj), data=subset(speaker.type, audio_video == "video" & 
                                                                                           caregiver == "FAMILY"), REML=FALSE)
speaker.type.model.discrete <- lmerTest::lmer(Log.n ~ Siblings6 + month + sex + (1|subj), data=subset(speaker.type, audio_video == "video" & 
                                                                                           caregiver == "FAMILY"), REML=FALSE)

speaker.type_anova.discrete <- anova(speaker.type.model.discrete, speaker.type.model.null.discrete) %>% #p<.01
  rename("pval" = `Pr(>Chisq)`)

input.model.summary.discrete <- summary(speaker.type.model.discrete)

input.model.summary.table.discrete <- input.model.summary.discrete$coefficients %>%
  as.data.frame %>%
  rename("p value" = "Pr(>|t|)") %>%
  rownames_to_column(var="Effect") %>%
  mutate(Effect = ifelse(Effect == "(Intercept)", "Intercept", Effect)) %>%
  # printnum(
  #   digits = c(2, 2, 2, 2, 3, 3)) %>%
  mutate(`p value` = scales::pvalue(`p value`),
         Variable = ifelse(Effect == "Intercept", "Caregiver input", ""))

```

```{r Object.presence summary, include=FALSE}

object.presence.discrete.summary <- object.presence %>%
  filter(audio_video == "video") %>%
  group_by(subj, Siblings6) %>%
  summarise(mean.object = mean(PC),
            sd.object = sd(PC),
            med.object = median(PC))

```

```{r object.presence model discrete, include=FALSE}

object.presence.model.discrete <- lmerTest::lmer(PC ~ Siblings6 + month + (1|subj), data=subset(object.presence,  audio_video == "video"), REML=FALSE)
object.presence.model.null.discrete <- lmerTest::lmer(PC ~ month + (1|subj), data=subset(object.presence,  audio_video == "video"), REML=FALSE)

object.presence.anova.discrete <- anova(object.presence.model.discrete, object.presence.model.null.discrete) %>% # p<.01
  rename("pval" = `Pr(>Chisq)`)

object.presence.model.summary.discrete <- summary(object.presence.model.discrete)

table.object.presence.model.discrete.summary <- object.presence.model.summary.discrete$coefficients %>%
  as.data.frame %>%
  rename("p value" = "Pr(>|t|)") %>%
  rownames_to_column(var="Effect") %>%
  mutate(Effect = ifelse(Effect == "(Intercept)", "Intercept", Effect)) %>%
  # printnum(
  #   digits = c(2, 2, 2, 2, 3, 3)) %>%
  mutate(`p value` = scales::pvalue(`p value`),
         Variable = ifelse(Effect == "Intercept", "Object presence", ""))

input.variables.model.summaries.discrete <- rbind(input.model.summary.table.discrete, table.object.presence.model.discrete.summary) %>%
  dplyr::select(Variable, Effect, Estimate, `Std. Error`, `df`, `t value`, `p value`)

```

```{r model outputs - discrete siblings, include = FALSE}

table.input.model.output.discrete <- rbind(speaker.type_anova.discrete, object.presence.anova.discrete
                                ) %>%
  rownames_to_column(var="model") %>%
  filter(Chisq > 0) %>%
  rename("p value" = "pval") %>%
  mutate(Model = ifelse(grepl("speaker", model), "Caregiver input", "Object presence")) %>%
  select(Model, Df, Chisq, `p value`)

```

As discrete sibling number, as well as sibling group, revealed siblings to be a significant predictor of vocabulary size at 18 months, we re-ran our input models using discrete sibling number as a fixed effect, instead of sibling group. Outputs from model comparisons and full model outputs including estimates are shown in Tables \@ref(tab:table-model-comparisons-discrete) and \@ref(tab:table-input-model-summary-discrete). Results were consistent with those reported for sibling group suggesting both characterizations of siblinghood capture similar relationships among our variables.

<!-- eb2cl: remind reader what discrete sib # and sib group means and what you put in the main and why (and thus what this SI section adds) -->
<!-- eb2cl: same comments as for audio section above regarding model stuff. -->
<!-- eb2cl: not sure why "Siblings6" is what's showing up in the table: can you double check that your variables in the model are coded as intended (i.e. what the baseline and then other levels are?) -->


```{r table-model-comparisons-discrete, echo = FALSE}
cap = "Full model output from linear mixed effects regression models comparing our two input measures in relation to discrete sibling number. Age in months was included as a fixed effect; subject was included as a random effect."
 kable(table.input.model.output.discrete, "latex", booktabs=T, longtable=T, 
       escape=FALSE,
       caption=cap, digits=2, align="c") 
```

```{r table-input-model-summary-discrete, echo = FALSE}
cap = "Full model output from linear mixed effects regression models comparing our two input measures (object words produced in caregiver input and object presence) over time in relation to discrete sibling number. Age in months was included as a fixed effect in both models and subject was included as a random effect."
 kable(input.variables.model.summaries.discrete, "latex", booktabs=T, longtable=T, 
       escape=FALSE,
       caption=cap, digits=2, align="c") %>%
   row_spec(4, hline_after = T)
```

\newpage

## S5: Possible outlier for input data removed

```{r speaker.type model one infant removed, include = FALSE}

speaker.type.red <- speaker.type %>% filter(subj != 738)

speaker.type.model.null.red <- lmerTest::lmer(Log.n ~ month + sex + (1|subj), data=subset(speaker.type.red, audio_video == "video" & 
                                                                                           caregiver == "FAMILY"), REML=FALSE)
speaker.type.model.red <- lmerTest::lmer(Log.n ~ SibGroup + month + sex + (1|subj), data=subset(speaker.type.red, audio_video == "video" & 
                                                                                           caregiver == "FAMILY"), REML=FALSE)

speaker.type_anova.red <- anova(speaker.type.model.red, speaker.type.model.null.red) %>% #p<.01
  rename("pval" = `Pr(>Chisq)`)

input.model.summary.red <- summary(speaker.type.model.red)

input.model.summary.table.red <- input.model.summary.red$coefficients %>%
  as.data.frame %>%
  rename("p value" = "Pr(>|t|)") %>%
  rownames_to_column(var="Effect") %>%
  mutate(Effect = ifelse(Effect == "(Intercept)", "Intercept", Effect)) %>%
  # printnum(
  #   digits = c(2, 2, 2, 2, 3, 3)) %>%
  mutate(`p value` = scales::pvalue(`p value`),
         Variable = ifelse(Effect == "Intercept", "Caregiver input", ""))

```

```{r object.presence model one infant removed, include=FALSE}

object.presence.red <- object.presence %>% filter(subj != 738)

object.presence.model.red <- lmerTest::lmer(PC ~ SibGroup + month + (1|subj), data=subset(object.presence.red,  audio_video == "video"), REML=FALSE)
object.presence.model.null.red <- lmerTest::lmer(PC ~ month + (1|subj), data=subset(object.presence.red,  audio_video == "video"), REML=FALSE)

object.presence.anova.red <- anova(object.presence.model.red, object.presence.model.null.red) %>% # p<.01
  rename("pval" = `Pr(>Chisq)`)

object.presence.model.summary.red <- summary(object.presence.model.red)

table.object.presence.model.red.summary <- object.presence.model.summary.red$coefficients %>%
  as.data.frame %>%
  rename("p value" = "Pr(>|t|)") %>%
  rownames_to_column(var="Effect") %>%
  mutate(Effect = ifelse(Effect == "(Intercept)", "Intercept", Effect)) %>%
  # printnum(
  #   digits = c(2, 2, 2, 2, 3, 3)) %>%
  mutate(`p value` = scales::pvalue(`p value`),
         Variable = ifelse(Effect == "Intercept", "Object presence", ""))

input.variables.model.summaries.red <- rbind(input.model.summary.table.red, table.object.presence.model.red.summary) %>%
  dplyr::select(Variable, Effect, Estimate, `Std. Error`, `df`, `t value`, `p value`)

```

```{r model outputs - one infant removed, include = FALSE}

table.input.model.output.red <- rbind(speaker.type_anova.red, object.presence.anova.red
                                ) %>%
  rownames_to_column(var="model") %>%
  filter(Chisq > 0) %>%
  rename("p value" = "pval") %>%
  mutate(Model = ifelse(grepl("speaker", model), "Caregiver input", "Object presence")) %>%
  select(Model, Df, Chisq, `p value`)


input.variables.model.summaries.red <- rbind(input.model.summary.table.red, table.object.presence.model.red.summary) %>%
  dplyr::select(Variable, Effect, Estimate, `Std. Error`, `df`, `t value`, `p value`)

```

One infant heard substantially more nouns in their input and nouns with object presence than the other 42 infants in the main sample for four of their recording sessions. We retain this infant in the main analysis, but confirm here that results were consistent when this child was removed from the analysis of input data (n=42). Results were consistent with those reported for sibling group. See Tables \@ref(tab:table-model-comparisons-red) and \@ref(tab:table-input-model-summary-red). 
<!-- eb2cl: can we simplify sentence 2 and 3 to jsut say all patterns of results in the main analysis hold when this child is removed (if that's true)? -->
<!-- eb2cl: same comments as above for models; i'd probably put some of the caption info like 3 SDd above the mean etc in the blurb not the caption but not a big deal either way -->

```{r table-model-comparisons-red, echo = FALSE}
cap = "Full model output from linear mixed effects regression models comparing our two input measures in relation to sibling group, with one infant removed who was identified as hearing substantially more input speech (3SDs above the group mean) in 4 recordings (n=42). Age in months was included as a fixed effect; subject was included as a random effect."
 kable(table.input.model.output.red, "latex", booktabs=T, longtable=T, 
       escape=FALSE,
       caption=cap, digits=2, align="c") 
```

```{r table-input-model-summary-red, echo = FALSE}
cap = "Full model output from linear mixed effects regression models comparing our two input measures (object words produced in caregiver input and object presence) over time in relation to sibling group, with one infant removed who was identified as hearing substantially more input speech (3SDs above the group mean) in 4 recordings (n=42). Age in months was included as a fixed effect in both models and subject was included as a random effect."
 kable(input.variables.model.summaries.red, "latex", booktabs=T, longtable=T, 
       escape=FALSE,
       caption=cap, digits=2, align="c") %>%
   row_spec(5, hline_after = T)
```
